<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> 
</head>

<body>

    <div id = "plot-target"></div>

    <script type="module">

        import { Model, Link, Log, LoadNode, GridSupplyNode } from '../../build/visual-modeller-energy.js';
        import * as Plot from "https://cdn.jsdelivr.net/npm/@observablehq/plot@0.6/+esm";
        import * as d3 from "https://cdn.skypack.dev/d3@7";

        const npts = 24*60*60; // seconds in a day
        const time = d3.range(npts);
        const load = time.map(d => (500 + 500*Math.exp( -1.*((d-20000)/5000)**2 ) + 1000*Math.exp( -1.*((d-60000)/7000)**2 ) ));
        const plotData = time.map((d,i) => ({time: d, load: load[i]}));
        const plot = Plot.plot({
            marks: [
                Plot.line(plotData, {x: "time", y: "load", stroke: "black"}),
                Plot.ruleY([0]),
                Plot.ruleX([0])
            ],
            x: {label: "Time (s)"},
            y: {label: "Load (W)"}
        });
        d3.select("#plot-target").node().append(plot);

        const model = new Model({timeSteps: npts, timeVarying:true });
        const gridSupplyNode = new GridSupplyNode({});
        const loadNode = new LoadNode({state:{max: null, value:null, constraint: true, timeVarying: true, timeSeries: load}});
        model.addNode(gridSupplyNode);
        model.addNode(loadNode);
        const link = new Link({socket1: gridSupplyNode, socket2: loadNode});
        model.addLink(link);
        model.addLog(new Log({name:"supply power", target:link.state.value}));
        model.run;



    </script>
</body>


</html>