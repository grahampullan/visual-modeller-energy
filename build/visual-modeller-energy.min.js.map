{"version":3,"file":"visual-modeller-energy.min.js","sources":["../node_modules/visual-modeller-core/build/visual-modeller-core.js","../src/EnergyNode.js","../src/ControllerNode.js","../src/GridExportNode.js","../src/GridSupplyNode.js","../src/EnergyLink.js","../src/LoadNode.js","../src/EnergyModel.js","../src/SolarPVNode.js"],"sourcesContent":["class Model {\n    constructor(options) {\n        this.nodes = options.nodes || [];\n        this.links = options.links || [];\n        this.logs = options.logs || [];\n        this.maxNodeId = 0;\n        this.maxLinkId = 0;\n        this.maxLogId = 0;\n    }\n\n    getNodeId() {\n        let newNodeId = `node-${this.maxNodeId}`;\n        this.maxNodeId++;\n        return newNodeId;\n    }\n\n    getLinkId() {\n        let newLinkId = `link-${this.maxLinkId}`;\n        this.maxLinkId++;\n        return newLinkId;\n    }\n\n    getLogId() {\n        let newLogId = `log-${this.maxLogId}`;\n        this.maxLogId++;\n        return newLogId;\n    }\n\n    addNode(node) {\n        node.id = this.getNodeId();\n        this.nodes.push(node);\n    }\n\n    addLink(link) {\n        link.id = this.getLinkId();\n        this.links.push(link);\n    }\n\n    addLog(log) {\n        log.id = this.getLogId();\n        this.logs.push(log);\n    }\n\n    removeNode(node) {\n        this.nodes = this.nodes.filter(n => n !== node);\n    }\n\n    removeLink(link) {\n        this.links = this.links.filter(l => l !== link);\n    }\n\n    removeLog(log) {\n        this.logs = this.logs.filter(l => l !== log);\n    }\n\n    removeNodeById(id) {\n        this.nodes = this.nodes.filter(n => n.id !== id);\n    }\n\n    removeLinkById(id) {\n        this.links = this.links.filter(l => l.id !== id);\n    }\n\n    removeLogById(id) {\n        this.logs = this.logs.filter(l => l.id !== id);\n    }\n}\n\nclass Node {\n    constructor(options) {\n        this.name = options.name || 'node';\n        this.sockets = [];\n        this.state = options.state || {};\n        this.maxSocketId = 0;\n        if (options.sockets) {\n            options.sockets.forEach(socket => {\n                this.addSocket(socket);\n            });\n        }\n    }\n\n    getSocketId() {\n        let newSocketId = this.maxSocketId;\n        this.maxSocketId++;\n        return newSocketId;\n    }\n\n    get leftSockets() {\n        return this.sockets.filter(s => s.position === 'left');\n    }\n\n    get rightSockets() {\n        return this.sockets.filter(s => s.position === 'right');\n    }\n\n    get topSockets() {\n        return this.sockets.filter(s => s.position === 'top');\n    }\n\n    get bottomSockets() {\n        return this.sockets.filter(s => s.position === 'bottom');\n    }\n    \n    addSocket(socket) {\n        socket.id = this.getSocketId();\n        this.sockets.push(socket);\n    }\n\n    setSocketByIndex(index, socket) {\n        socket.id = this.getSocketId();\n        this.sockets[index] = socket;\n    }\n\n    getSocketByIndex(index) {\n        return this.sockets[index];\n    }   \n\n    removeSocket(socket) {\n        this.sockets = this.sockets.filter(s => s !== socket);\n    }\n\n    removeSocketById(id) {\n        this.sockets = this.sockets.filter(s => s.id !== id);\n    }\n\n    removeSocketByIndex(index) {\n        this.sockets = this.sockets.filter((s, i) => i !== index);\n    }\n\n}\n\nclass Socket {\n    constructor(options) {\n        this.name = options.name || 'socket';\n        this.state = options.state || {};\n        this.linkId = options.linkId || '';\n        this.position = options.position || 'left';  \n    }\n}\n\nclass Link {\n    constructor(options) {\n        this.socket1 = options.socket1 || null;\n        this.socket2 = options.socket2 || null;\n        this.state = options.state || {};\n    }\n}\n\nclass Log {\n    constructor(options) {\n        this.name = options.name || 'log';\n        this.target = options.target || null;\n        this.states = [];\n    }\n\n    writeToLog() {\n        this.states.push(this.target.state);\n    }\n}\n\nexport { Link, Log, Model, Node, Socket };\n","import { Node } from 'visual-modeller-core';\n\nclass EnergyNode extends Node {\n    constructor(options) {\n        super(options);\n    }\n\n    setConstraints(){\n        return;\n    }\n    \n    updateState(){\n        return;\n    }\n}\n\n\nexport { EnergyNode };","import { EnergyNode } from \"./EnergyNode\";\n\nclass ControllerNode extends EnergyNode {\n    constructor(options) {\n        super(options);\n        this.class = 'controlNode';\n        this.type = 'controller';\n        this.inputSocketOrder = options.inputSocketOrder || [];\n        this.outputSocketOrder = options.outputSocketOrder || [];\n    }\n\n}\n\nexport { ControllerNode };","import { EnergyNode } from \"./EnergyNode\";\nimport { Socket } from 'visual-modeller-core';\n\nclass GridExportNode extends EnergyNode {\n    constructor(options) {\n        super(options);\n        this.class = 'endNode';\n        this.type = 'gridExport';\n        const socketOptions = {};\n        socketOptions.name = options.name || 'Grid Export';\n        socketOptions.linkId = options.linkId || '';\n        socketOptions.position = options.position || 'left';\n        socketOptions.state = options.state || {max: Infinity, value:null, constraint: false};\n        this.setSocketByIndex(0, new Socket(socketOptions));\n    }\n}\n\nexport { GridExportNode };","import { EnergyNode } from \"./EnergyNode\";\nimport { Socket } from 'visual-modeller-core';\n\nclass GridSupplyNode extends EnergyNode {\n    constructor(options) {\n        super(options);\n        this.class = 'endNode';\n        this.type = 'gridSupply';\n        const socketOptions = {};\n        socketOptions.name = options.name || 'Grid Supply';\n        socketOptions.linkId = options.linkId || '';\n        socketOptions.position = options.position || 'right'; // output on right side\n        socketOptions.state = options.state || {max: Infinity, value:null, constraint: false};\n        console.log(this);\n        this.setSocketByIndex(0, new Socket(socketOptions)); // endNode so only one socket\n    }\n}\n\nexport { GridSupplyNode };","import { Link } from 'visual-modeller-core';\n\nclass EnergyLink extends Link {\n    constructor(options) {\n        super(options);\n    }\n\n    setFlux() {\n        const socket1 = this.socket1;\n        const state1 = socket1.state;\n        const socket2 = this.socket2;\n        const state2 = socket2.state;\n\n        //console.log(state1);\n        //console.log(state2);\n\n        if (state1.constraint) {\n            if (state2.constraint) {\n                console.log('problem - both sockets have constraints', this);\n            } else {\n                if (state1.value <= state2.max) {\n                    this.state.value = state1.value;\n                }\n            }\n        }\n\n        if (state2.constraint) {\n            if (state1.constraint) {\n                console.log('problem - both sockets have constraints', this);\n            } else {\n                if (state2.value <= state1.max) {\n                    this.state.value = state2.value;\n                }\n            }\n        }\n\n    }\n\n}\n\nexport { EnergyLink };","import { EnergyNode } from \"./EnergyNode\";\nimport { Socket } from 'visual-modeller-core';\n\nclass LoadNode extends EnergyNode {\n    constructor(options) {\n        super(options);\n        this.class = 'endNode';\n        this.type = 'loadNode';\n        const socketOptions = {};\n        socketOptions.name = options.name || 'Load';\n        socketOptions.linkId = options.linkId || '';\n        socketOptions.position = options.position || 'left'; // input on left side\n        socketOptions.state = options.state || {max: null, value:null, constraint: true, timeVarying: false, timeSeries: null};\n        this.setSocketByIndex(0, new Socket(socketOptions)); // endNode so only one socket\n    }\n\n    setConstraints(data) {\n        const timeStep = data.timeStep;\n        const state = this.getSocketByIndex(0).state;\n        if (!state.constraint) {\n            return;\n        }\n        if (state.timeVarying) {\n            state.value = state.timeSeries[timeStep];\n        } \n    }\n\n}\n\nexport { LoadNode };","import { Model } from 'visual-modeller-core';\n\nclass EnergyModel extends Model {\n    constructor(options) {\n        super(options);\n        this.timeVarying = options.timeVarying || false;\n        this.timeSteps = options.timeSteps || 1;\n        this.timeStep = 0;\n    }\n\n    run() {\n        const nodes = this.nodes;\n        const links = this.links;\n        const logs = this.logs;\n        const timeVarying = this.timeVarying;\n        const timeSteps = this.timeSteps;\n        if (!timeVarying) {\n            this.timeSteps = 1;\n        }\n\n        for (let i = 0; i < timeSteps; i++) {\n            this.timeStep = i;\n            // solution process:\n            //     allNodes - set fixed fluxes and flux limits - e.g. constrained fluxes\n            //     socket.state.fluxTarget is set\n\n            nodes.forEach(node => node.setConstraints({timeStep:i})); // needs to know time step\n\n            //     allControllerNodes - set flux targets on sockets\n\n            nodes.filter(node => node.type === 'controller').forEach(controllerNode => controllerNode.setFluxTargets());\n\n            //     allLinks - set fluxes using targets\n\n            links.forEach(link => link.setFlux());\n\n            //     allNodes - update state given current fluxes (e.g. battery)\n\n            nodes.forEach(node => node.updateState());\n\n            //    finally update logs\n            //    logs is array of objects {\"name\", [values]}\n\n            logs.forEach( log => log.writeToLog());\n            \n        }\n\n    }\n}\n\nexport { EnergyModel };\n\n\n\n","import { EnergyNode } from \"./EnergyNode\";\nimport { Socket } from 'visual-modeller-core';\n\nclass SolarPVNode extends EnergyNode {\n    constructor(options) {\n        super(options);\n        this.class = 'endNode';\n        this.type = 'solarPVNode';\n        const socketOptions = {};\n        socketOptions.name = options.name || 'Solar PV';\n        socketOptions.linkId = options.linkId || '';\n        socketOptions.position = options.position || 'right'; // output on right side\n        socketOptions.state = options.state || {max: null, value:null, constraint: true, timeVarying: false, timeSeries: null};\n        this.setSocketByIndex(0, new Socket(socketOptions)); // endNode so only one socket\n    }\n\n    setConstraints(data) {\n        const timeStep = data.timeStep;\n        const state = this.getSocketByIndex(0).state;\n        if (!state.constraint) {\n            return;\n        }\n        if (state.timeVarying) {\n            state.value = state.timeSeries[timeStep];\n        } \n    }\n\n}\n\nexport { SolarPVNode };"],"names":["Model","constructor","options","this","nodes","links","logs","maxNodeId","maxLinkId","maxLogId","getNodeId","newNodeId","getLinkId","newLinkId","getLogId","newLogId","addNode","node","id","push","addLink","link","addLog","log","removeNode","filter","n","removeLink","l","removeLog","removeNodeById","removeLinkById","removeLogById","Node","name","sockets","state","maxSocketId","forEach","socket","addSocket","getSocketId","newSocketId","leftSockets","s","position","rightSockets","topSockets","bottomSockets","setSocketByIndex","index","getSocketByIndex","removeSocket","removeSocketById","removeSocketByIndex","i","Socket","linkId","Link","socket1","socket2","EnergyNode","super","setConstraints","updateState","class","type","inputSocketOrder","outputSocketOrder","socketOptions","max","Infinity","value","constraint","console","setFlux","state1","state2","timeVarying","timeSeries","data","timeStep","target","states","writeToLog","timeSteps","run","controllerNode","setFluxTargets"],"mappings":"kDAAA,MAAMA,EACF,WAAAC,CAAYC,GACRC,KAAKC,MAAQF,EAAQE,OAAS,GAC9BD,KAAKE,MAAQH,EAAQG,OAAS,GAC9BF,KAAKG,KAAOJ,EAAQI,MAAQ,GAC5BH,KAAKI,UAAY,EACjBJ,KAAKK,UAAY,EACjBL,KAAKM,SAAW,CACnB,CAED,SAAAC,GACI,IAAIC,EAAY,QAAQR,KAAKI,YAE7B,OADAJ,KAAKI,YACEI,CACV,CAED,SAAAC,GACI,IAAIC,EAAY,QAAQV,KAAKK,YAE7B,OADAL,KAAKK,YACEK,CACV,CAED,QAAAC,GACI,IAAIC,EAAW,OAAOZ,KAAKM,WAE3B,OADAN,KAAKM,WACEM,CACV,CAED,OAAAC,CAAQC,GACJA,EAAKC,GAAKf,KAAKO,YACfP,KAAKC,MAAMe,KAAKF,EACnB,CAED,OAAAG,CAAQC,GACJA,EAAKH,GAAKf,KAAKS,YACfT,KAAKE,MAAMc,KAAKE,EACnB,CAED,MAAAC,CAAOC,GACHA,EAAIL,GAAKf,KAAKW,WACdX,KAAKG,KAAKa,KAAKI,EAClB,CAED,UAAAC,CAAWP,GACPd,KAAKC,MAAQD,KAAKC,MAAMqB,QAAOC,GAAKA,IAAMT,GAC7C,CAED,UAAAU,CAAWN,GACPlB,KAAKE,MAAQF,KAAKE,MAAMoB,QAAOG,GAAKA,IAAMP,GAC7C,CAED,SAAAQ,CAAUN,GACNpB,KAAKG,KAAOH,KAAKG,KAAKmB,QAAOG,GAAKA,IAAML,GAC3C,CAED,cAAAO,CAAeZ,GACXf,KAAKC,MAAQD,KAAKC,MAAMqB,QAAOC,GAAKA,EAAER,KAAOA,GAChD,CAED,cAAAa,CAAeb,GACXf,KAAKE,MAAQF,KAAKE,MAAMoB,QAAOG,GAAKA,EAAEV,KAAOA,GAChD,CAED,aAAAc,CAAcd,GACVf,KAAKG,KAAOH,KAAKG,KAAKmB,QAAOG,GAAKA,EAAEV,KAAOA,GAC9C,EAGL,MAAMe,EACF,WAAAhC,CAAYC,GACRC,KAAK+B,KAAOhC,EAAQgC,MAAQ,OAC5B/B,KAAKgC,QAAU,GACfhC,KAAKiC,MAAQlC,EAAQkC,OAAS,CAAA,EAC9BjC,KAAKkC,YAAc,EACfnC,EAAQiC,SACRjC,EAAQiC,QAAQG,SAAQC,IACpBpC,KAAKqC,UAAUD,EAAO,GAGjC,CAED,WAAAE,GACI,IAAIC,EAAcvC,KAAKkC,YAEvB,OADAlC,KAAKkC,cACEK,CACV,CAED,eAAIC,GACA,OAAOxC,KAAKgC,QAAQV,QAAOmB,GAAoB,SAAfA,EAAEC,UACrC,CAED,gBAAIC,GACA,OAAO3C,KAAKgC,QAAQV,QAAOmB,GAAoB,UAAfA,EAAEC,UACrC,CAED,cAAIE,GACA,OAAO5C,KAAKgC,QAAQV,QAAOmB,GAAoB,QAAfA,EAAEC,UACrC,CAED,iBAAIG,GACA,OAAO7C,KAAKgC,QAAQV,QAAOmB,GAAoB,WAAfA,EAAEC,UACrC,CAED,SAAAL,CAAUD,GACNA,EAAOrB,GAAKf,KAAKsC,cACjBtC,KAAKgC,QAAQhB,KAAKoB,EACrB,CAED,gBAAAU,CAAiBC,EAAOX,GACpBA,EAAOrB,GAAKf,KAAKsC,cACjBtC,KAAKgC,QAAQe,GAASX,CACzB,CAED,gBAAAY,CAAiBD,GACb,OAAO/C,KAAKgC,QAAQe,EACvB,CAED,YAAAE,CAAab,GACTpC,KAAKgC,QAAUhC,KAAKgC,QAAQV,QAAOmB,GAAKA,IAAML,GACjD,CAED,gBAAAc,CAAiBnC,GACbf,KAAKgC,QAAUhC,KAAKgC,QAAQV,QAAOmB,GAAKA,EAAE1B,KAAOA,GACpD,CAED,mBAAAoC,CAAoBJ,GAChB/C,KAAKgC,QAAUhC,KAAKgC,QAAQV,QAAO,CAACmB,EAAGW,IAAMA,IAAML,GACtD,EAIL,MAAMM,EACF,WAAAvD,CAAYC,GACRC,KAAK+B,KAAOhC,EAAQgC,MAAQ,SAC5B/B,KAAKiC,MAAQlC,EAAQkC,OAAS,CAAA,EAC9BjC,KAAKsD,OAASvD,EAAQuD,QAAU,GAChCtD,KAAK0C,SAAW3C,EAAQ2C,UAAY,MACvC,EAGL,MAAMa,EACF,WAAAzD,CAAYC,GACRC,KAAKwD,QAAUzD,EAAQyD,SAAW,KAClCxD,KAAKyD,QAAU1D,EAAQ0D,SAAW,KAClCzD,KAAKiC,MAAQlC,EAAQkC,OAAS,CAAA,CACjC,EC/IL,MAAMyB,UAAmB5B,EACrB,WAAAhC,CAAYC,GACR4D,MAAM5D,EACT,CAED,cAAA6D,GAEC,CAED,WAAAC,GAEC,0BCXL,cAA6BH,EACzB,WAAA5D,CAAYC,GACR4D,MAAM5D,GACNC,KAAK8D,MAAQ,cACb9D,KAAK+D,KAAO,aACZ/D,KAAKgE,iBAAmBjE,EAAQiE,kBAAoB,GACpDhE,KAAKiE,kBAAoBlE,EAAQkE,mBAAqB,EACzD,oBCNL,cAA6BP,EACzB,WAAA5D,CAAYC,GACR4D,MAAM5D,GACNC,KAAK8D,MAAQ,UACb9D,KAAK+D,KAAO,aACZ,MAAMG,EAAgB,CAAA,EACtBA,EAAcnC,KAAOhC,EAAQgC,MAAQ,cACrCmC,EAAcZ,OAASvD,EAAQuD,QAAU,GACzCY,EAAcxB,SAAW3C,EAAQ2C,UAAY,OAC7CwB,EAAcjC,MAAQlC,EAAQkC,OAAS,CAACkC,IAAKC,IAAUC,MAAM,KAAMC,YAAY,GAC/EtE,KAAK8C,iBAAiB,EAAG,IAAIO,EAAOa,GACvC,oBCXL,cAA6BR,EACzB,WAAA5D,CAAYC,GACR4D,MAAM5D,GACNC,KAAK8D,MAAQ,UACb9D,KAAK+D,KAAO,aACZ,MAAMG,EAAgB,CAAA,EACtBA,EAAcnC,KAAOhC,EAAQgC,MAAQ,cACrCmC,EAAcZ,OAASvD,EAAQuD,QAAU,GACzCY,EAAcxB,SAAW3C,EAAQ2C,UAAY,QAC7CwB,EAAcjC,MAAQlC,EAAQkC,OAAS,CAACkC,IAAKC,IAAUC,MAAM,KAAMC,YAAY,GAC/EC,QAAQnD,IAAIpB,MACZA,KAAK8C,iBAAiB,EAAG,IAAIO,EAAOa,GACvC,UCbL,cAAyBX,EACrB,WAAAzD,CAAYC,GACR4D,MAAM5D,EACT,CAED,OAAAyE,GACI,MACMC,EADUzE,KAAKwD,QACEvB,MAEjByC,EADU1E,KAAKyD,QACExB,MAKnBwC,EAAOH,aACHI,EAAOJ,WACPC,QAAQnD,IAAI,0CAA2CpB,MAEnDyE,EAAOJ,OAASK,EAAOP,MACvBnE,KAAKiC,MAAMoC,MAAQI,EAAOJ,QAKlCK,EAAOJ,aACHG,EAAOH,WACPC,QAAQnD,IAAI,0CAA2CpB,MAEnD0E,EAAOL,OAASI,EAAON,MACvBnE,KAAKiC,MAAMoC,MAAQK,EAAOL,OAKzC,cCjCL,cAAuBX,EACnB,WAAA5D,CAAYC,GACR4D,MAAM5D,GACNC,KAAK8D,MAAQ,UACb9D,KAAK+D,KAAO,WACZ,MAAMG,EAAgB,CAAA,EACtBA,EAAcnC,KAAOhC,EAAQgC,MAAQ,OACrCmC,EAAcZ,OAASvD,EAAQuD,QAAU,GACzCY,EAAcxB,SAAW3C,EAAQ2C,UAAY,OAC7CwB,EAAcjC,MAAQlC,EAAQkC,OAAS,CAACkC,IAAK,KAAME,MAAM,KAAMC,YAAY,EAAMK,aAAa,EAAOC,WAAY,MACjH5E,KAAK8C,iBAAiB,EAAG,IAAIO,EAAOa,GACvC,CAED,cAAAN,CAAeiB,GACX,MAAMC,EAAWD,EAAKC,SAChB7C,EAAQjC,KAAKgD,iBAAiB,GAAGf,MAClCA,EAAMqC,YAGPrC,EAAM0C,cACN1C,EAAMoC,MAAQpC,EAAM2C,WAAWE,GAEtC,SN2HL,MACI,WAAAhF,CAAYC,GACRC,KAAK+B,KAAOhC,EAAQgC,MAAQ,MAC5B/B,KAAK+E,OAAShF,EAAQgF,QAAU,KAChC/E,KAAKgF,OAAS,EACjB,CAED,UAAAC,GACIjF,KAAKgF,OAAOhE,KAAKhB,KAAK+E,OAAO9C,MAChC,WO3JL,cAA0BpC,EACtB,WAAAC,CAAYC,GACR4D,MAAM5D,GACNC,KAAK2E,YAAc5E,EAAQ4E,cAAe,EAC1C3E,KAAKkF,UAAYnF,EAAQmF,WAAa,EACtClF,KAAK8E,SAAW,CACnB,CAED,GAAAK,GACI,MAAMlF,EAAQD,KAAKC,MACbC,EAAQF,KAAKE,MACbC,EAAOH,KAAKG,KACZwE,EAAc3E,KAAK2E,YACnBO,EAAYlF,KAAKkF,UAClBP,IACD3E,KAAKkF,UAAY,GAGrB,IAAK,IAAI9B,EAAI,EAAGA,EAAI8B,EAAW9B,IAC3BpD,KAAK8E,SAAW1B,EAKhBnD,EAAMkC,SAAQrB,GAAQA,EAAK8C,eAAe,CAACkB,SAAS1B,MAIpDnD,EAAMqB,QAAOR,GAAsB,eAAdA,EAAKiD,OAAuB5B,SAAQiD,GAAkBA,EAAeC,mBAI1FnF,EAAMiC,SAAQjB,GAAQA,EAAKsD,YAI3BvE,EAAMkC,SAAQrB,GAAQA,EAAK+C,gBAK3B1D,EAAKgC,SAASf,GAAOA,EAAI6D,cAIhC,iBC5CL,cAA0BvB,EACtB,WAAA5D,CAAYC,GACR4D,MAAM5D,GACNC,KAAK8D,MAAQ,UACb9D,KAAK+D,KAAO,cACZ,MAAMG,EAAgB,CAAA,EACtBA,EAAcnC,KAAOhC,EAAQgC,MAAQ,WACrCmC,EAAcZ,OAASvD,EAAQuD,QAAU,GACzCY,EAAcxB,SAAW3C,EAAQ2C,UAAY,QAC7CwB,EAAcjC,MAAQlC,EAAQkC,OAAS,CAACkC,IAAK,KAAME,MAAM,KAAMC,YAAY,EAAMK,aAAa,EAAOC,WAAY,MACjH5E,KAAK8C,iBAAiB,EAAG,IAAIO,EAAOa,GACvC,CAED,cAAAN,CAAeiB,GACX,MAAMC,EAAWD,EAAKC,SAChB7C,EAAQjC,KAAKgD,iBAAiB,GAAGf,MAClCA,EAAMqC,YAGPrC,EAAM0C,cACN1C,EAAMoC,MAAQpC,EAAM2C,WAAWE,GAEtC","x_google_ignoreList":[0]}